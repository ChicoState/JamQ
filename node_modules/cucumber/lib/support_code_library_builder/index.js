'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SupportCodeLibraryBuilder = undefined;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _util = require('util');

var _util2 = _interopRequireDefault(_util);

var _parameter_type_registry_builder = require('./parameter_type_registry_builder');

var _parameter_type_registry_builder2 = _interopRequireDefault(_parameter_type_registry_builder);

var _build_helpers = require('./build_helpers');

var _finalize_helpers = require('./finalize_helpers');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var SupportCodeLibraryBuilder = exports.SupportCodeLibraryBuilder = function () {
  function SupportCodeLibraryBuilder() {
    var _this = this;

    (0, _classCallCheck3.default)(this, SupportCodeLibraryBuilder);

    this.methods = {
      defineParameterType: this.defineParameterType.bind(this),
      After: this.defineTestCaseHook('afterTestCaseHookDefinitions'),
      AfterAll: this.defineTestRunHook('afterTestRunHookDefinitions'),
      Before: this.defineTestCaseHook('beforeTestCaseHookDefinitions'),
      BeforeAll: this.defineTestRunHook('beforeTestRunHookDefinitions'),
      defineStep: this.defineStep.bind(this),
      defineSupportCode: _util2.default.deprecate(function (fn) {
        fn(_this.methods);
      }, 'cucumber: defineSupportCode is deprecated. Please require/import the individual methods instead.'),
      setDefaultTimeout: function setDefaultTimeout(milliseconds) {
        _this.options.defaultTimeout = milliseconds;
      },
      setDefinitionFunctionWrapper: function setDefinitionFunctionWrapper(fn) {
        _this.options.definitionFunctionWrapper = fn;
      },
      setWorldConstructor: function setWorldConstructor(fn) {
        _this.options.World = fn;
      }
    };
    this.methods.Given = this.methods.When = this.methods.Then = this.methods.defineStep;
  }

  (0, _createClass3.default)(SupportCodeLibraryBuilder, [{
    key: 'defineParameterType',
    value: function defineParameterType(options) {
      var parameterType = (0, _build_helpers.buildParameterType)(options);
      this.options.parameterTypeRegistry.defineParameterType(parameterType);
    }
  }, {
    key: 'defineStep',
    value: function defineStep(pattern, options, code) {
      var stepDefinitionConfig = (0, _build_helpers.buildStepDefinitionConfig)({
        pattern: pattern,
        options: options,
        code: code,
        cwd: this.cwd
      });
      this.options.stepDefinitionConfigs.push(stepDefinitionConfig);
    }
  }, {
    key: 'defineTestCaseHook',
    value: function defineTestCaseHook(collectionName) {
      var _this2 = this;

      return function (options, code) {
        var hookDefinition = (0, _build_helpers.buildTestCaseHookDefinition)({
          options: options,
          code: code,
          cwd: _this2.cwd
        });
        _this2.options[collectionName].push(hookDefinition);
      };
    }
  }, {
    key: 'defineTestRunHook',
    value: function defineTestRunHook(collectionName) {
      var _this3 = this;

      return function (options, code) {
        var hookDefinition = (0, _build_helpers.buildTestRunHookDefinition)({
          options: options,
          code: code,
          cwd: _this3.cwd
        });
        _this3.options[collectionName].push(hookDefinition);
      };
    }
  }, {
    key: 'finalize',
    value: function finalize() {
      var _this4 = this;

      this.options.stepDefinitions = this.options.stepDefinitionConfigs.map(function (config) {
        return (0, _build_helpers.buildStepDefinitionFromConfig)({
          config: config,
          parameterTypeRegistry: _this4.options.parameterTypeRegistry
        });
      });
      delete this.options.stepDefinitionConfigs;
      (0, _finalize_helpers.wrapDefinitions)({
        cwd: this.cwd,
        definitionFunctionWrapper: this.options.definitionFunctionWrapper,
        definitions: _lodash2.default.chain(['afterTestCaseHook', 'afterTestRunHook', 'beforeTestCaseHook', 'beforeTestRunHook', 'step']).map(function (key) {
          return _this4.options[key + 'Definitions'];
        }).flatten().value()
      });
      this.options.afterTestCaseHookDefinitions.reverse();
      this.options.afterTestRunHookDefinitions.reverse();
      return this.options;
    }
  }, {
    key: 'reset',
    value: function reset(cwd) {
      this.cwd = cwd;
      this.options = _lodash2.default.cloneDeep({
        afterTestCaseHookDefinitions: [],
        afterTestRunHookDefinitions: [],
        beforeTestCaseHookDefinitions: [],
        beforeTestRunHookDefinitions: [],
        defaultTimeout: 5000,
        definitionFunctionWrapper: null,
        stepDefinitionConfigs: [],
        parameterTypeRegistry: _parameter_type_registry_builder2.default.build(),
        World: function World(_ref) {
          var attach = _ref.attach,
              parameters = _ref.parameters;

          this.attach = attach;
          this.parameters = parameters;
        }
      });
    }
  }]);
  return SupportCodeLibraryBuilder;
}();

exports.default = new SupportCodeLibraryBuilder();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdXBwb3J0X2NvZGVfbGlicmFyeV9idWlsZGVyL2luZGV4LmpzIl0sIm5hbWVzIjpbIlN1cHBvcnRDb2RlTGlicmFyeUJ1aWxkZXIiLCJtZXRob2RzIiwiZGVmaW5lUGFyYW1ldGVyVHlwZSIsImJpbmQiLCJBZnRlciIsImRlZmluZVRlc3RDYXNlSG9vayIsIkFmdGVyQWxsIiwiZGVmaW5lVGVzdFJ1bkhvb2siLCJCZWZvcmUiLCJCZWZvcmVBbGwiLCJkZWZpbmVTdGVwIiwiZGVmaW5lU3VwcG9ydENvZGUiLCJkZXByZWNhdGUiLCJmbiIsInNldERlZmF1bHRUaW1lb3V0Iiwib3B0aW9ucyIsImRlZmF1bHRUaW1lb3V0IiwibWlsbGlzZWNvbmRzIiwic2V0RGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlciIsImRlZmluaXRpb25GdW5jdGlvbldyYXBwZXIiLCJzZXRXb3JsZENvbnN0cnVjdG9yIiwiV29ybGQiLCJHaXZlbiIsIldoZW4iLCJUaGVuIiwicGFyYW1ldGVyVHlwZSIsInBhcmFtZXRlclR5cGVSZWdpc3RyeSIsInBhdHRlcm4iLCJjb2RlIiwic3RlcERlZmluaXRpb25Db25maWciLCJjd2QiLCJzdGVwRGVmaW5pdGlvbkNvbmZpZ3MiLCJwdXNoIiwiY29sbGVjdGlvbk5hbWUiLCJob29rRGVmaW5pdGlvbiIsInN0ZXBEZWZpbml0aW9ucyIsIm1hcCIsImNvbmZpZyIsImRlZmluaXRpb25zIiwiY2hhaW4iLCJrZXkiLCJmbGF0dGVuIiwidmFsdWUiLCJhZnRlclRlc3RDYXNlSG9va0RlZmluaXRpb25zIiwicmV2ZXJzZSIsImFmdGVyVGVzdFJ1bkhvb2tEZWZpbml0aW9ucyIsImNsb25lRGVlcCIsImJlZm9yZVRlc3RDYXNlSG9va0RlZmluaXRpb25zIiwiYmVmb3JlVGVzdFJ1bkhvb2tEZWZpbml0aW9ucyIsImJ1aWxkIiwiYXR0YWNoIiwicGFyYW1ldGVycyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7O0FBT0E7Ozs7SUFFYUEseUIsV0FBQUEseUI7QUFDWCx1Q0FBYztBQUFBOztBQUFBOztBQUNaLFNBQUtDLE9BQUwsR0FBZTtBQUNiQywyQkFBcUIsS0FBS0EsbUJBQUwsQ0FBeUJDLElBQXpCLENBQThCLElBQTlCLENBRFI7QUFFYkMsYUFBTyxLQUFLQyxrQkFBTCxDQUF3Qiw4QkFBeEIsQ0FGTTtBQUdiQyxnQkFBVSxLQUFLQyxpQkFBTCxDQUF1Qiw2QkFBdkIsQ0FIRztBQUliQyxjQUFRLEtBQUtILGtCQUFMLENBQXdCLCtCQUF4QixDQUpLO0FBS2JJLGlCQUFXLEtBQUtGLGlCQUFMLENBQXVCLDhCQUF2QixDQUxFO0FBTWJHLGtCQUFZLEtBQUtBLFVBQUwsQ0FBZ0JQLElBQWhCLENBQXFCLElBQXJCLENBTkM7QUFPYlEseUJBQW1CLGVBQUtDLFNBQUwsQ0FBZSxjQUFNO0FBQ3RDQyxXQUFHLE1BQUtaLE9BQVI7QUFDRCxPQUZrQixFQUVoQixrR0FGZ0IsQ0FQTjtBQVViYSx5QkFBbUIseUNBQWdCO0FBQ2pDLGNBQUtDLE9BQUwsQ0FBYUMsY0FBYixHQUE4QkMsWUFBOUI7QUFDRCxPQVpZO0FBYWJDLG9DQUE4QiwwQ0FBTTtBQUNsQyxjQUFLSCxPQUFMLENBQWFJLHlCQUFiLEdBQXlDTixFQUF6QztBQUNELE9BZlk7QUFnQmJPLDJCQUFxQixpQ0FBTTtBQUN6QixjQUFLTCxPQUFMLENBQWFNLEtBQWIsR0FBcUJSLEVBQXJCO0FBQ0Q7QUFsQlksS0FBZjtBQW9CQSxTQUFLWixPQUFMLENBQWFxQixLQUFiLEdBQXFCLEtBQUtyQixPQUFMLENBQWFzQixJQUFiLEdBQW9CLEtBQUt0QixPQUFMLENBQWF1QixJQUFiLEdBQW9CLEtBQUt2QixPQUFMLENBQWFTLFVBQTFFO0FBQ0Q7Ozs7d0NBRW1CSyxPLEVBQVM7QUFDM0IsVUFBTVUsZ0JBQWdCLHVDQUFtQlYsT0FBbkIsQ0FBdEI7QUFDQSxXQUFLQSxPQUFMLENBQWFXLHFCQUFiLENBQW1DeEIsbUJBQW5DLENBQXVEdUIsYUFBdkQ7QUFDRDs7OytCQUVVRSxPLEVBQVNaLE8sRUFBU2EsSSxFQUFNO0FBQ2pDLFVBQU1DLHVCQUF1Qiw4Q0FBMEI7QUFDckRGLHdCQURxRDtBQUVyRFosd0JBRnFEO0FBR3JEYSxrQkFIcUQ7QUFJckRFLGFBQUssS0FBS0E7QUFKMkMsT0FBMUIsQ0FBN0I7QUFNQSxXQUFLZixPQUFMLENBQWFnQixxQkFBYixDQUFtQ0MsSUFBbkMsQ0FBd0NILG9CQUF4QztBQUNEOzs7dUNBRWtCSSxjLEVBQWdCO0FBQUE7O0FBQ2pDLGFBQU8sVUFBQ2xCLE9BQUQsRUFBVWEsSUFBVixFQUFtQjtBQUN4QixZQUFNTSxpQkFBaUIsZ0RBQTRCO0FBQ2pEbkIsMEJBRGlEO0FBRWpEYSxvQkFGaUQ7QUFHakRFLGVBQUssT0FBS0E7QUFIdUMsU0FBNUIsQ0FBdkI7QUFLQSxlQUFLZixPQUFMLENBQWFrQixjQUFiLEVBQTZCRCxJQUE3QixDQUFrQ0UsY0FBbEM7QUFDRCxPQVBEO0FBUUQ7OztzQ0FFaUJELGMsRUFBZ0I7QUFBQTs7QUFDaEMsYUFBTyxVQUFDbEIsT0FBRCxFQUFVYSxJQUFWLEVBQW1CO0FBQ3hCLFlBQU1NLGlCQUFpQiwrQ0FBMkI7QUFDaERuQiwwQkFEZ0Q7QUFFaERhLG9CQUZnRDtBQUdoREUsZUFBSyxPQUFLQTtBQUhzQyxTQUEzQixDQUF2QjtBQUtBLGVBQUtmLE9BQUwsQ0FBYWtCLGNBQWIsRUFBNkJELElBQTdCLENBQWtDRSxjQUFsQztBQUNELE9BUEQ7QUFRRDs7OytCQUVVO0FBQUE7O0FBQ1QsV0FBS25CLE9BQUwsQ0FBYW9CLGVBQWIsR0FBK0IsS0FBS3BCLE9BQUwsQ0FBYWdCLHFCQUFiLENBQW1DSyxHQUFuQyxDQUM3QjtBQUFBLGVBQ0Usa0RBQThCO0FBQzVCQyx3QkFENEI7QUFFNUJYLGlDQUF1QixPQUFLWCxPQUFMLENBQWFXO0FBRlIsU0FBOUIsQ0FERjtBQUFBLE9BRDZCLENBQS9CO0FBT0EsYUFBTyxLQUFLWCxPQUFMLENBQWFnQixxQkFBcEI7QUFDQSw2Q0FBZ0I7QUFDZEQsYUFBSyxLQUFLQSxHQURJO0FBRWRYLG1DQUEyQixLQUFLSixPQUFMLENBQWFJLHlCQUYxQjtBQUdkbUIscUJBQWEsaUJBQUVDLEtBQUYsQ0FBUSxDQUNuQixtQkFEbUIsRUFFbkIsa0JBRm1CLEVBR25CLG9CQUhtQixFQUluQixtQkFKbUIsRUFLbkIsTUFMbUIsQ0FBUixFQU9WSCxHQVBVLENBT047QUFBQSxpQkFBTyxPQUFLckIsT0FBTCxDQUFnQnlCLEdBQWhCLGlCQUFQO0FBQUEsU0FQTSxFQVFWQyxPQVJVLEdBU1ZDLEtBVFU7QUFIQyxPQUFoQjtBQWNBLFdBQUszQixPQUFMLENBQWE0Qiw0QkFBYixDQUEwQ0MsT0FBMUM7QUFDQSxXQUFLN0IsT0FBTCxDQUFhOEIsMkJBQWIsQ0FBeUNELE9BQXpDO0FBQ0EsYUFBTyxLQUFLN0IsT0FBWjtBQUNEOzs7MEJBRUtlLEcsRUFBSztBQUNULFdBQUtBLEdBQUwsR0FBV0EsR0FBWDtBQUNBLFdBQUtmLE9BQUwsR0FBZSxpQkFBRStCLFNBQUYsQ0FBWTtBQUN6Qkgsc0NBQThCLEVBREw7QUFFekJFLHFDQUE2QixFQUZKO0FBR3pCRSx1Q0FBK0IsRUFITjtBQUl6QkMsc0NBQThCLEVBSkw7QUFLekJoQyx3QkFBZ0IsSUFMUztBQU16QkcsbUNBQTJCLElBTkY7QUFPekJZLCtCQUF1QixFQVBFO0FBUXpCTCwrQkFBdUIsMENBQXVCdUIsS0FBdkIsRUFSRTtBQVN6QjVCLGFBVHlCLHVCQVNLO0FBQUEsY0FBdEI2QixNQUFzQixRQUF0QkEsTUFBc0I7QUFBQSxjQUFkQyxVQUFjLFFBQWRBLFVBQWM7O0FBQzVCLGVBQUtELE1BQUwsR0FBY0EsTUFBZDtBQUNBLGVBQUtDLFVBQUwsR0FBa0JBLFVBQWxCO0FBQ0Q7QUFad0IsT0FBWixDQUFmO0FBY0Q7Ozs7O2tCQUdZLElBQUluRCx5QkFBSixFIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJ1xuaW1wb3J0IHV0aWwgZnJvbSAndXRpbCdcbmltcG9ydCBUcmFuc2Zvcm1Mb29rdXBCdWlsZGVyIGZyb20gJy4vcGFyYW1ldGVyX3R5cGVfcmVnaXN0cnlfYnVpbGRlcidcbmltcG9ydCB7XG4gIGJ1aWxkUGFyYW1ldGVyVHlwZSxcbiAgYnVpbGRTdGVwRGVmaW5pdGlvbkNvbmZpZyxcbiAgYnVpbGRTdGVwRGVmaW5pdGlvbkZyb21Db25maWcsXG4gIGJ1aWxkVGVzdENhc2VIb29rRGVmaW5pdGlvbixcbiAgYnVpbGRUZXN0UnVuSG9va0RlZmluaXRpb24sXG59IGZyb20gJy4vYnVpbGRfaGVscGVycydcbmltcG9ydCB7IHdyYXBEZWZpbml0aW9ucyB9IGZyb20gJy4vZmluYWxpemVfaGVscGVycydcblxuZXhwb3J0IGNsYXNzIFN1cHBvcnRDb2RlTGlicmFyeUJ1aWxkZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLm1ldGhvZHMgPSB7XG4gICAgICBkZWZpbmVQYXJhbWV0ZXJUeXBlOiB0aGlzLmRlZmluZVBhcmFtZXRlclR5cGUuYmluZCh0aGlzKSxcbiAgICAgIEFmdGVyOiB0aGlzLmRlZmluZVRlc3RDYXNlSG9vaygnYWZ0ZXJUZXN0Q2FzZUhvb2tEZWZpbml0aW9ucycpLFxuICAgICAgQWZ0ZXJBbGw6IHRoaXMuZGVmaW5lVGVzdFJ1bkhvb2soJ2FmdGVyVGVzdFJ1bkhvb2tEZWZpbml0aW9ucycpLFxuICAgICAgQmVmb3JlOiB0aGlzLmRlZmluZVRlc3RDYXNlSG9vaygnYmVmb3JlVGVzdENhc2VIb29rRGVmaW5pdGlvbnMnKSxcbiAgICAgIEJlZm9yZUFsbDogdGhpcy5kZWZpbmVUZXN0UnVuSG9vaygnYmVmb3JlVGVzdFJ1bkhvb2tEZWZpbml0aW9ucycpLFxuICAgICAgZGVmaW5lU3RlcDogdGhpcy5kZWZpbmVTdGVwLmJpbmQodGhpcyksXG4gICAgICBkZWZpbmVTdXBwb3J0Q29kZTogdXRpbC5kZXByZWNhdGUoZm4gPT4ge1xuICAgICAgICBmbih0aGlzLm1ldGhvZHMpXG4gICAgICB9LCAnY3VjdW1iZXI6IGRlZmluZVN1cHBvcnRDb2RlIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSByZXF1aXJlL2ltcG9ydCB0aGUgaW5kaXZpZHVhbCBtZXRob2RzIGluc3RlYWQuJyksXG4gICAgICBzZXREZWZhdWx0VGltZW91dDogbWlsbGlzZWNvbmRzID0+IHtcbiAgICAgICAgdGhpcy5vcHRpb25zLmRlZmF1bHRUaW1lb3V0ID0gbWlsbGlzZWNvbmRzXG4gICAgICB9LFxuICAgICAgc2V0RGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlcjogZm4gPT4ge1xuICAgICAgICB0aGlzLm9wdGlvbnMuZGVmaW5pdGlvbkZ1bmN0aW9uV3JhcHBlciA9IGZuXG4gICAgICB9LFxuICAgICAgc2V0V29ybGRDb25zdHJ1Y3RvcjogZm4gPT4ge1xuICAgICAgICB0aGlzLm9wdGlvbnMuV29ybGQgPSBmblxuICAgICAgfSxcbiAgICB9XG4gICAgdGhpcy5tZXRob2RzLkdpdmVuID0gdGhpcy5tZXRob2RzLldoZW4gPSB0aGlzLm1ldGhvZHMuVGhlbiA9IHRoaXMubWV0aG9kcy5kZWZpbmVTdGVwXG4gIH1cblxuICBkZWZpbmVQYXJhbWV0ZXJUeXBlKG9wdGlvbnMpIHtcbiAgICBjb25zdCBwYXJhbWV0ZXJUeXBlID0gYnVpbGRQYXJhbWV0ZXJUeXBlKG9wdGlvbnMpXG4gICAgdGhpcy5vcHRpb25zLnBhcmFtZXRlclR5cGVSZWdpc3RyeS5kZWZpbmVQYXJhbWV0ZXJUeXBlKHBhcmFtZXRlclR5cGUpXG4gIH1cblxuICBkZWZpbmVTdGVwKHBhdHRlcm4sIG9wdGlvbnMsIGNvZGUpIHtcbiAgICBjb25zdCBzdGVwRGVmaW5pdGlvbkNvbmZpZyA9IGJ1aWxkU3RlcERlZmluaXRpb25Db25maWcoe1xuICAgICAgcGF0dGVybixcbiAgICAgIG9wdGlvbnMsXG4gICAgICBjb2RlLFxuICAgICAgY3dkOiB0aGlzLmN3ZCxcbiAgICB9KVxuICAgIHRoaXMub3B0aW9ucy5zdGVwRGVmaW5pdGlvbkNvbmZpZ3MucHVzaChzdGVwRGVmaW5pdGlvbkNvbmZpZylcbiAgfVxuXG4gIGRlZmluZVRlc3RDYXNlSG9vayhjb2xsZWN0aW9uTmFtZSkge1xuICAgIHJldHVybiAob3B0aW9ucywgY29kZSkgPT4ge1xuICAgICAgY29uc3QgaG9va0RlZmluaXRpb24gPSBidWlsZFRlc3RDYXNlSG9va0RlZmluaXRpb24oe1xuICAgICAgICBvcHRpb25zLFxuICAgICAgICBjb2RlLFxuICAgICAgICBjd2Q6IHRoaXMuY3dkLFxuICAgICAgfSlcbiAgICAgIHRoaXMub3B0aW9uc1tjb2xsZWN0aW9uTmFtZV0ucHVzaChob29rRGVmaW5pdGlvbilcbiAgICB9XG4gIH1cblxuICBkZWZpbmVUZXN0UnVuSG9vayhjb2xsZWN0aW9uTmFtZSkge1xuICAgIHJldHVybiAob3B0aW9ucywgY29kZSkgPT4ge1xuICAgICAgY29uc3QgaG9va0RlZmluaXRpb24gPSBidWlsZFRlc3RSdW5Ib29rRGVmaW5pdGlvbih7XG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIGNvZGUsXG4gICAgICAgIGN3ZDogdGhpcy5jd2QsXG4gICAgICB9KVxuICAgICAgdGhpcy5vcHRpb25zW2NvbGxlY3Rpb25OYW1lXS5wdXNoKGhvb2tEZWZpbml0aW9uKVxuICAgIH1cbiAgfVxuXG4gIGZpbmFsaXplKCkge1xuICAgIHRoaXMub3B0aW9ucy5zdGVwRGVmaW5pdGlvbnMgPSB0aGlzLm9wdGlvbnMuc3RlcERlZmluaXRpb25Db25maWdzLm1hcChcbiAgICAgIGNvbmZpZyA9PlxuICAgICAgICBidWlsZFN0ZXBEZWZpbml0aW9uRnJvbUNvbmZpZyh7XG4gICAgICAgICAgY29uZmlnLFxuICAgICAgICAgIHBhcmFtZXRlclR5cGVSZWdpc3RyeTogdGhpcy5vcHRpb25zLnBhcmFtZXRlclR5cGVSZWdpc3RyeSxcbiAgICAgICAgfSlcbiAgICApXG4gICAgZGVsZXRlIHRoaXMub3B0aW9ucy5zdGVwRGVmaW5pdGlvbkNvbmZpZ3NcbiAgICB3cmFwRGVmaW5pdGlvbnMoe1xuICAgICAgY3dkOiB0aGlzLmN3ZCxcbiAgICAgIGRlZmluaXRpb25GdW5jdGlvbldyYXBwZXI6IHRoaXMub3B0aW9ucy5kZWZpbml0aW9uRnVuY3Rpb25XcmFwcGVyLFxuICAgICAgZGVmaW5pdGlvbnM6IF8uY2hhaW4oW1xuICAgICAgICAnYWZ0ZXJUZXN0Q2FzZUhvb2snLFxuICAgICAgICAnYWZ0ZXJUZXN0UnVuSG9vaycsXG4gICAgICAgICdiZWZvcmVUZXN0Q2FzZUhvb2snLFxuICAgICAgICAnYmVmb3JlVGVzdFJ1bkhvb2snLFxuICAgICAgICAnc3RlcCcsXG4gICAgICBdKVxuICAgICAgICAubWFwKGtleSA9PiB0aGlzLm9wdGlvbnNbYCR7a2V5fURlZmluaXRpb25zYF0pXG4gICAgICAgIC5mbGF0dGVuKClcbiAgICAgICAgLnZhbHVlKCksXG4gICAgfSlcbiAgICB0aGlzLm9wdGlvbnMuYWZ0ZXJUZXN0Q2FzZUhvb2tEZWZpbml0aW9ucy5yZXZlcnNlKClcbiAgICB0aGlzLm9wdGlvbnMuYWZ0ZXJUZXN0UnVuSG9va0RlZmluaXRpb25zLnJldmVyc2UoKVxuICAgIHJldHVybiB0aGlzLm9wdGlvbnNcbiAgfVxuXG4gIHJlc2V0KGN3ZCkge1xuICAgIHRoaXMuY3dkID0gY3dkXG4gICAgdGhpcy5vcHRpb25zID0gXy5jbG9uZURlZXAoe1xuICAgICAgYWZ0ZXJUZXN0Q2FzZUhvb2tEZWZpbml0aW9uczogW10sXG4gICAgICBhZnRlclRlc3RSdW5Ib29rRGVmaW5pdGlvbnM6IFtdLFxuICAgICAgYmVmb3JlVGVzdENhc2VIb29rRGVmaW5pdGlvbnM6IFtdLFxuICAgICAgYmVmb3JlVGVzdFJ1bkhvb2tEZWZpbml0aW9uczogW10sXG4gICAgICBkZWZhdWx0VGltZW91dDogNTAwMCxcbiAgICAgIGRlZmluaXRpb25GdW5jdGlvbldyYXBwZXI6IG51bGwsXG4gICAgICBzdGVwRGVmaW5pdGlvbkNvbmZpZ3M6IFtdLFxuICAgICAgcGFyYW1ldGVyVHlwZVJlZ2lzdHJ5OiBUcmFuc2Zvcm1Mb29rdXBCdWlsZGVyLmJ1aWxkKCksXG4gICAgICBXb3JsZCh7IGF0dGFjaCwgcGFyYW1ldGVycyB9KSB7XG4gICAgICAgIHRoaXMuYXR0YWNoID0gYXR0YWNoXG4gICAgICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtZXRlcnNcbiAgICAgIH0sXG4gICAgfSlcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBuZXcgU3VwcG9ydENvZGVMaWJyYXJ5QnVpbGRlcigpXG4iXX0=